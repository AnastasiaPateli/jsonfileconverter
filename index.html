<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tenancy Agreement Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: Arial, sans-serif; }
        .agreement { margin-bottom: 2rem; padding: 1rem; border: 1px solid #ccc; }
    </style>
</head>
<body class="bg-gray-100 p-6">
    <div class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow">
        <h1 class="text-2xl font-bold mb-4">Tenancy Agreement Generator</h1>
        <input type="file" id="jsonInput" accept=".json" class="mb-4">
        <div id="agreements" class="mt-4"></div>
    </div>

    <script>
        // Template for the tenancy agreement
        const agreementTemplate = `
ΙΔΙΩΤΙΚΟ ΣΥΜΦΩΝΗΤΙΚΟ ΑΓΡΟΜΙΣΘΩΣΗΣ

Σήμερα την 1η Νοεμβρίου 2024 στο Δημητρίτσι οι υπογράφοντες το συμφωνητικό αυτό 
αφενός ο/η {{owner_name}} του {{owner_father_name}}, κάτοικος {{owner_address}} οδός {{owner_street}} αρ {{owner_street_number}}
Α.Φ.Μ {{owner_tin}} Δ.Ο.Υ {{owner_doy}}
και αφετέρου η ΕΛΕΥΘΕΡΙΑ ΤΖΟΤΣΙΚΑ του ΓΕΩΡΓΙΟΣ επαγγέλματος αγρότης
κάτοικος Δημητρίτσι οδός - αρ. -
Α.Φ.Μ 136332321 Δ.Ο.Υ Α Σερρών
συμφώνησαν από κοινού και αποδέχτηκαν τα εξής:
1. ΜΙΣΘΙΟ. Ο πρώτος συμβαλλόμενος ("εκμισθωτής") έχει στην αποκλειστική κυριότητα, νομή και κατοχή του τους κάτωθι αγρούς:
    Α/Α  ΚΟΙΝΟΤΗΤΑ  ΤΟΠΟΘΕΣΙΑ  Α.Τ.Α.Κ.  ΑΡ.ΚΤΗΜ.ΤΕΜ.  ΧΑΡΤΟΓΡΑΦΙΚΟ  ΕΚΤΑΣΗ (Ha)
{{fields_table}}
Ο εκμισθωτής εκμισθώνει με το παρόν συμφωνητικό στο μισθωτή τους παραπάνω αγρούς, με τους εξής όρους και συμφωνίες που είναι όλοι ουσιώδεις:
2. ΔΙΑΡΚΕIΑ. Η διάρκεια της παρούσας μίσθωσης ορίζεται:
Αρχίζει την 1η ΝΟΕΜΒΡΙΟΥ 2024 και λήγει την 31η ΟΚΤΩΒΡΙΟΥ 2032.
3. ΜΙΣΘΩΜΑ. Το ετήσιο μίσθωμα ορίζεται σε ευρώ 100 /ΣΤΡ
4. ΧΡΗΣΗ. Ο μίσθιος αγρός θα χρησιμοποιηθεί για αποκλειστικά για αγροτική καλλιέργεια. Απαγορεύεται απόλυτα οποιαδήποτε μετατροπή της χρήσης ή του τρόπου εκμετάλλευσης του μισθίου, η ολική ή μερική υπομίσθωσή του, ή η με οποιοδήποτε τρόπο, με ή χωρίς αντάλλαγμα παραχώρηση της χρήσης του μισθίου σε τρίτους καθώς και η πρόσληψη συνεταίρου, χωρίς την προηγούμενη έγγραφη συναίνεση του εκμισθωτή.
5. ΚΑΛΗ ΧΡΗΣΗ ΤΟΥ ΜΙΣΘΙΟΥ. Ο μισθωτής υποχρεούται να κάνει καλή χρήση του μισθίου, να το εκμεταλλεύεται με επιμέλεια και σύμφωνα με τον προορισμό του και να το διατηρεί κατάλληλο για τη συμφωνημένη χρήση, κάνοντας με αποκλειστική δαπάνη και επιμέλειά του κάθε είδους τακτικές ή έκτακτες επισκευές ή βελτιώσεις, διαφορετικά, ευθύνεται για αποζημίωση για τις φθορές και τις βλάβες που προξενήθησαν σ' αυτό.
Το παρόν μισθωτήριο διαβάστηκε και έγινε αποδεκτό από τούς συμβαλλομένους, υπογράφη από αυτούς και ο καθένας έλαβε από ένα όμοιο αντίτυπο.
ΟΙ ΣΥΜΒΑΛΛΟΜΕΝΟΙ
Ο ΕΚΜΙΣΘΩΤΗΣ             ΘΕΩΡΗΘΗΚΕ             Ο ΜΙΣΘΩΤΗΣ 
Για το γνήσιο των υπογραφών
ΗΜΕΡΟΜΗΝΙΑ
`;

        // Function to process JSON and generate agreements
        document.getElementById('jsonInput').addEventListener('change', async (event) => {
            const file = event.target.files[0];
            if (!file) return;

            const readerHANDEL reader = new FileReader();
            reader.onload = async (e) => {
                const jsonData = JSON.parse(e.target.result);
                const agreementsDiv = document.getElementById('agreements');
                agreementsDiv.innerHTML = '';

                // Group fields by owner TIN
                const ownerFields = {};
                jsonData.field_list.forEach(field => {
                    field.field_property_list.forEach(property => {
                        const tin = property.tin;
                        if (!ownerFields[tin]) {
                            ownerFields[tin] = {
                                name: property.full_name,
                                fields: [],
                                tin: tin
                            };
                        }
                        ownerFields[tin].fields.push({
                            community: field.field_info.location.split('-')[0],
                            location: field.field_info.location,
                            atak: property.atak,
                            property_number: property.legal_possession_document_number,
                            cartographic: field.field_geospatial_data.cartographic_background,
                            area: field.field_cultivation_list[0].total_area
                        });
                    });
                });

                // Generate agreements
                Object.values(ownerFields).forEach((owner, index) => {
                    // Extract owner details from JSON
                    const ownerDetails = jsonData.applicant_detail;
                    const fieldsTable = owner.fields.map((f, i) => 
                        `    ${i + 1}. ${f.community} ${f.location} ${f.atak || '-'} ${f.property_number || '-'} ${f.cartographic} ${f.area}`
                    ).join('\n');

                    const agreementText = agreementTemplate
                        .replace('{{owner_name}}', owner.name)
                        .replace('{{owner_father_name}}', '-')
                        .replace('{{owner_address}}', ownerDetails.post_code || '62200')
                        .replace('{{owner_street}}', ownerDetails.street || '-')
                        .replace('{{owner_street_number}}', ownerDetails.street_number || '-')
                        .replace('{{owner_tin}}', owner.tin)
                        .replace('{{owner_doy}}', ownerDetails.tax_office_code || 'Α Σερρών')
                        .replace('{{fields_table}}', fieldsTable);

                    // Create agreement element
                    const agreementElement = document.createElement('div');
                    agreementElement.className = 'agreement';
                    agreementElement.innerHTML = `
                        <h2 class="text-xl font-bold mb-2">Agreement for ${owner.name}</h2>
                        <pre class="whitespace-pre-wrap">${agreementText}</pre>
                        <button class="mt-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" onclick="downloadAgreement('${owner.tin}', \`${agreementText}\`)">Download Agreement</button>
                    `;
                    agreementsDiv.appendChild(agreementElement);
                });
            };
            reader.readAsText(file);
        });

        // Function to download agreement as a text file
        function downloadAgreement(tin, text) {
            const blob = new Blob([text], { type: 'colnapplication/octet-stream' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `tenancy_agreement_${tin}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>

